        <div class="card" dir="rtl">
            <p-toast />
            <p-confirmdialog />

            <div class="flex flex-col gap-2 mb-6">
                <div class="text-xl font-semibold text-surface-900 dark:text-surface-0">جدول اذرع الجمع</div>
                <div class="text-surface-600 dark:text-surface-300 text-sm">واجهة عرض مبنية على list.xhtml (UI فقط).</div>
            </div>

            <p-divider />

            <p-toolbar styleClass="mb-6">
                <ng-template #start>
                    <div class="flex flex-wrap gap-2 items-center">
                        <p-multiselect
                            [options]="allColumns"
                            optionLabel="header"
                            [(ngModel)]="visibleColumns"
                            display="chip"
                            placeholder="الأعمدة"
                        />

                        <p-button
                            label="ترحيل"
                            icon="pi pi-plus"
                            severity="success"
                            [disabled]="selectedRows().length === 0"
                            (onClick)="openTransferMulti()"
                        />
                    </div>
                </ng-template>

                <ng-template #end>
                    <div class="flex flex-wrap gap-2 items-center justify-end">
                        <p-button label="بحث" severity="success" (onClick)="applyMuFilter()" />

                        <p-select
                            [options]="managementUnits"
                            optionLabel="path"
                            optionValue="id"
                            [(ngModel)]="muFilterId"
                            placeholder="البحث عن طريق الوحدة الادارية"
                            [filter]="true"
                            filterBy="path"
                            [showClear]="true"
                            styleClass="min-w-64"
                        />

                        <p-iconfield>
                            <p-inputicon styleClass="pi pi-search" />
                            <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="البحث ..." />
                        </p-iconfield>
                    </div>
                </ng-template>
            </p-toolbar>

            <p-table
                #dt
                [value]="rowsView()"
                [rows]="20"
                [paginator]="true"
                [rowHover]="true"
                dataKey="id"
                [showGridlines]="true"
                [(selection)]="selectedRowsModel"
                selectionMode="multiple"
                currentPageReportTemplate="عرض {first} إلى {last} من {totalRecords}"
                [showCurrentPageReport]="true"
                [rowsPerPageOptions]="[20, 50, 100]"
                [globalFilterFields]="globalFilterFields"
                [tableStyle]="{ 'min-width': '110rem' }"
            >
                <ng-template #header>
                    <tr>
                        <th style="width: 3.5rem"><p-tableHeaderCheckbox /></th>
                        <th style="width: 16rem">تعديل / حـذف /المرفقات/ ترحيل</th>
                        <th style="width: 5rem">تسلسل</th>

                        <ng-container *ngFor="let col of visibleColumns">
                            <th [style.width]="col.width || null">{{ col.header }}</th>
                        </ng-container>
                    </tr>
                </ng-template>

                <ng-template #body let-row let-rowIndex="rowIndex">
                    <tr>
                        <td><p-tableCheckbox [value]="row" /></td>

                        <td>
                            <div class="flex gap-2 justify-end">
                                <p-button
                                    icon="pi pi-pencil"
                                    severity="secondary"
                                    [text]="true"
                                    [routerLink]="['/apps/additionArms/create']"
                                    [queryParams]="{ id: row.id }"
                                />
                                <p-button icon="pi pi-trash" severity="danger" [text]="true" (onClick)="confirmDelete(row)" />

                                <p-badge *ngIf="row.uploadFiles.length" [value]="row.uploadFiles.length" severity="secondary">
                                    <p-button icon="pi pi-eye" severity="secondary" [text]="true" (onClick)="openUpload(row)" />
                                </p-badge>
                                <p-button
                                    *ngIf="!row.uploadFiles.length"
                                    icon="pi pi-eye"
                                    severity="secondary"
                                    [text]="true"
                                    [disabled]="true"
                                />

                                <p-badge [value]="row.transfers.length" severity="danger">
                                    <p-button icon="pi pi-send" [text]="true" (onClick)="openTransfer(row)" />
                                </p-badge>
                            </div>
                        </td>

                        <td>{{ rowIndex + 1 }}</td>

                        <ng-container *ngFor="let col of visibleColumns">
                            <td>
                                <ng-container [ngSwitch]="col.field">
                                    <ng-container *ngSwitchCase="'reliability'">
                                        <span class="customer-badge" [ngClass]="reliabilityClass(row.reliability)">{{ row.reliability }}</span>
                                    </ng-container>

                                    <ng-container *ngSwitchCase="'securityFiles'">
                                        <div *ngFor="let sf of row.securityFiles">{{ sf.name }}</div>
                                    </ng-container>

                                    <ng-container *ngSwitchCase="'spreadingCountry'">
                                        <div *ngFor="let sp of row.spreadingPlaces">{{ sp.country?.name }}</div>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'spreadingCity'">
                                        <div *ngFor="let sp of row.spreadingPlaces">{{ sp.city?.name }}</div>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'spreadingDistrict'">
                                        <div *ngFor="let sp of row.spreadingPlaces">{{ sp.district?.name }}</div>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'spreadingHandDistrict'">
                                        <div *ngFor="let sp of row.spreadingPlaces">{{ sp.handDistrict?.name }}</div>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'spreadingNeighbourhood'">
                                        <div *ngFor="let sp of row.spreadingPlaces">{{ sp.neighbourhood }}</div>
                                    </ng-container>

                                    <ng-container *ngSwitchCase="'sourceOfficer'">
                                        {{ row.sourceOfficer.sourceSymbol }}
                                    </ng-container>

                                    <ng-container *ngSwitchCase="'muPath'">
                                        {{ muPath(row.mu_id) }}
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'dependencyMuPath'">
                                        {{ muPath(row.addition_arm_muId) }}
                                    </ng-container>

                                    <ng-container *ngSwitchCase="'cordinates'">
                                        {{ coordinatesString(row) }}
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'coordinateTypes'">
                                        <div *ngFor="let c of row.coordinates">{{ c.coordinateTypeName }}</div>
                                    </ng-container>

                                    <ng-container *ngSwitchCase="'createDate'">
                                        {{ formatDate(row.createDate) }}
                                    </ng-container>

                                    <ng-container *ngSwitchDefault>
                                        {{ valueByField(row, col.field) }}
                                    </ng-container>
                                </ng-container>
                            </td>
                        </ng-container>
                    </tr>
                </ng-template>

                <ng-template #emptymessage>
                    <tr>
                        <td [attr.colspan]="3 + visibleColumns.length" class="text-center text-surface-600 dark:text-surface-300">
                            لا توجد اذرع مضافة
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <p-dialog [(visible)]="uploadDialog" [modal]="true" [draggable]="false" [resizable]="true" [style]="{ width: '70rem' }">
                <ng-template #header>
                    <div class="font-semibold">المرفقات</div>
                </ng-template>

                <div class="flex flex-col gap-4" dir="rtl">
                    <p-table [value]="selectedUploadRows" [showGridlines]="true" [tableStyle]="{ 'min-width': '40rem' }">
                        <ng-template #header>
                            <tr>
                                <th>اسم المرفق</th>
                                <th style="width: 10rem">الصيغة</th>
                                <th style="width: 8rem">عرض</th>
                            </tr>
                        </ng-template>
                        <ng-template #body let-u>
                            <tr>
                                <td>{{ u.fileName }}</td>
                                <td>{{ u.extension }}</td>
                                <td class="text-center">
                                    <p-button icon="pi pi-eye" severity="secondary" [text]="true" (onClick)="noop()" />
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template #emptymessage>
                            <tr>
                                <td colspan="3" class="text-center text-surface-600 dark:text-surface-300">لا توجد مرفقات</td>
                            </tr>
                        </ng-template>
                    </p-table>

                    <div class="text-surface-600 dark:text-surface-300 text-sm">
                        معاينة المرفقات سيتم ربطها لاحقاً بعد ربط API.
                    </div>
                </div>
            </p-dialog>

            <p-dialog [(visible)]="transferDialog" [modal]="true" [draggable]="false" [resizable]="false" [style]="{ width: '60rem' }" header="الترحيل">
                <div class="flex flex-col gap-4" dir="rtl">
                    <div class="text-red-600 font-semibold">
                        من خلال الترحيل يمكنك مشاركة اذرع الجمع الخاص بك لوحدات ادارية اخرى
                    </div>

                    <div class="p-4 rounded-md border border-surface-200 dark:border-surface-700 bg-surface-50 dark:bg-surface-900">
                        <div class="font-semibold mb-3">اضافة ترحيل</div>

                        <div class="grid grid-cols-12 gap-3 items-center">
                            <div class="col-span-12 md:col-span-3 font-semibold">الوحدة الأدارية:</div>
                            <div class="col-span-12 md:col-span-7">
                                <p-select
                                    [options]="managementUnits"
                                    optionLabel="path"
                                    optionValue="id"
                                    [(ngModel)]="transferMuId"
                                    placeholder="يرجى الأختيار"
                                    [filter]="true"
                                    filterBy="path"
                                    [showClear]="true"
                                />
                            </div>
                            <div class="col-span-12 md:col-span-2 flex justify-end">
                                <p-button icon="pi pi-plus" (onClick)="addTransfer()" [disabled]="!transferMuId" />
                            </div>
                        </div>
                    </div>

                    <p-table [value]="transferList" [paginator]="true" [rows]="10" [showGridlines]="true" dataKey="id">
                        <ng-template #header>
                            <tr>
                                <th style="width: 6rem">حذف</th>
                                <th>الوحدة الإدارية</th>
                                <th style="width: 12rem">التحويل بواسطة</th>
                                <th style="width: 14rem">الوقت والتاريخ</th>
                            </tr>
                        </ng-template>
                        <ng-template #body let-tr>
                            <tr>
                                <td class="text-center">
                                    <p-button icon="pi pi-trash" severity="danger" [text]="true" (onClick)="confirmDeleteTransfer(tr)" />
                                </td>
                                <td>{{ muPath(tr.mu_tr_id) }}</td>
                                <td>{{ tr.nickName_tr }}</td>
                                <td>{{ formatDate(tr.createDate) }}</td>
                            </tr>
                        </ng-template>
                        <ng-template #emptymessage>
                            <tr>
                                <td colspan="4" class="text-center text-surface-600 dark:text-surface-300">لا توجد تحويلات</td>
                            </tr>
                        </ng-template>
                    </p-table>

                    <div class="flex justify-end">
                        <p-button label="الغاء" severity="secondary" (onClick)="closeTransfer()" />
                    </div>
                </div>
            </p-dialog>

            <p-dialog [(visible)]="transferMultiDialog" [modal]="true" [draggable]="false" [resizable]="false" [style]="{ width: '48rem' }" header="ترحيل المجموعة">
                <div class="flex flex-col gap-4" dir="rtl">
                    <div class="text-red-600 font-semibold">
                        من خلال الترحيل يمكنك مشاركة اذرع الجمع الخاص بك لوحدات ادارية اخرى
                    </div>

                    <div class="grid grid-cols-12 gap-3 items-center">
                        <div class="col-span-12 md:col-span-4 font-semibold">الوحدة الأدارية:</div>
                        <div class="col-span-12 md:col-span-6">
                            <p-select
                                [options]="managementUnits"
                                optionLabel="path"
                                optionValue="id"
                                [(ngModel)]="transferMuId"
                                placeholder="يرجى الأختيار"
                                [filter]="true"
                                filterBy="path"
                                [showClear]="true"
                            />
                        </div>
                        <div class="col-span-12 md:col-span-2 flex justify-end">
                            <p-button icon="pi pi-plus" (onClick)="addTransferMulti()" [disabled]="selectedRows().length === 0 || !transferMuId" />
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <p-button label="الغاء" severity="secondary" (onClick)="transferMultiDialog = false" />
                    </div>
                </div>
            </p-dialog>
        </div>
