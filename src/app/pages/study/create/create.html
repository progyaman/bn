<div dir="rtl">
    <p-toast />

    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
        <div>
            <div class="text-2xl font-semibold text-surface-900 dark:text-surface-0">الدراسة</div>
            <div class="text-sm text-surface-600 dark:text-surface-300">{{ editId ? 'تعديل دراسة' : 'إضافة دراسة' }}</div>
        </div>
        <div class="flex gap-2">
            <a class="p-button p-component p-button-secondary" routerLink="/study/list">
                <span class="p-button-icon pi pi-list"></span>
                <span class="p-button-label">قائمة الدراسات</span>
            </a>
            <p-button type="button" label="حفظ" icon="pi pi-save" (onClick)="save()" />
        </div>
    </div>

    <div class="card mb-0 ui-fluid">
        <div class="text-lg font-semibold text-surface-900 dark:text-surface-0 mb-4">بيانات الدراسة</div>

        <div class="grid grid-cols-12 gap-4">
            <div class="col-span-12 md:col-span-8">
                <label class="block font-medium mb-2">اسم الدراسة</label>
                <input pInputText [(ngModel)]="model.name" class="w-full" />
            </div>

            <div class="col-span-12 md:col-span-4">
                <label class="block font-medium mb-2">نوع الدراسة</label>
                <p-select [(ngModel)]="model.studyType" [options]="studyTypes" optionLabel="name" placeholder="يرجى الأختيار" class="w-full" />
            </div>

            <div class="col-span-12 md:col-span-8">
                <label class="block font-medium mb-2">مكان الأصدار</label>
                <input pInputText [(ngModel)]="model.placeIssue" class="w-full" />
            </div>

            <div class="col-span-12 md:col-span-4">
                <label class="block font-medium mb-2">التاريخ</label>
                <p-datepicker appendTo="body" [(ngModel)]="model.date" [showButtonBar]="true" dateFormat="yy-mm-dd" class="w-full" />
            </div>
        </div>

        <p-divider />

        <div class="text-lg font-semibold text-surface-900 dark:text-surface-0 mb-3">المرفقات</div>

        <p-fileupload
            mode="basic"
            name="studyFiles"
            chooseLabel="رفع مرفق"
            [multiple]="true"
            [maxFileSize]="104857640"
            (onSelect)="onFilesSelect($event)"
            styleClass="p-button-outlined"
        ></p-fileupload>
        <div class="text-xs text-surface-600 dark:text-surface-300 mt-2">واجهة تجريبية بدون رفع حقيقي</div>

        <div class="mt-3">
            <p-table [value]="model.uploadFiles" [paginator]="true" [rows]="10" responsiveLayout="scroll" showGridlines="true" stripedRows="true">
                <ng-template pTemplate="header">
                    <tr>
                        <th class="w-24">حذف</th>
                        <th>اسم الملف</th>
                        <th class="w-48">الحجم</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-row>
                    <tr>
                        <td>
                            <button
                                type="button"
                                class="p-button p-component p-button-rounded p-button-text p-button-danger"
                                (click)="removeAttachment(row.id)"
                            >
                                <span class="p-button-icon pi pi-trash"></span>
                            </button>
                        </td>
                        <td>{{ row.name }}</td>
                        <td>{{ row.size ? ((row.size / 1024) | number) : '-' }} KB</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="3" class="text-center">لا توجد مرفقات</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <p-divider />

        <div class="flex justify-end">
            <p-button type="button" label="حفظ" icon="pi pi-save" (onClick)="save()" />
        </div>
    </div>
</div>
